{% extends 'add_user/home.html' %}
{% load static %}

{% block content %}
<div class="container">
    <h2>Find Your Recommended Destinations</h2>

    <!-- Search form for destinations -->
   <!-- In the form, ensure that there's no conflict between the search suggestions and form submission -->
<form method="POST" id="interest-form">
    {% csrf_token %}
    <label for="destination">Enter Destination</label>
    <input type="text" id="destination" name="destination" placeholder="e.g., Mountains, Lakes, etc." required onkeyup="getSuggestions(this.value)">
    <!-- Disabled submit button to prevent form submission during search -->
    <button type="submit" id="submit-btn" style="display: none;" disabled>Get Recommendations</button>
</form>

<!-- Suggestions container -->
<div id="suggestions-container" style="margin-top: 20px; display: none;">
    <ul id="suggestions-list"></ul>
</div>

<!-- Recommendations container -->
<div id="recommendations-container" style="margin-top: 20px;">
    {% if recommendations %}
        <h3>Recommended Destinations:</h3>
        <ul>
            {% for category, places in recommendations.items %}
                <li>
                    <strong>{{ category|title }}:</strong>
                    <ul>
                        {% for place in places %}
                            <li>{{ place }}</li>
                        {% endfor %}
                    </ul>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No recommendations found for your search.</p>
    {% endif %}
</div>


</div>
{% endblock %}

{% block javascript %}
<script>
    console.log("Hello Sabahat");
    function getSuggestions(query) {
        console.log("I am in Sabahat");
        const suggestionsContainer = document.getElementById('suggestions-container');
        const suggestionsList = document.getElementById('suggestions-list');

        if (!query || query.trim().length < 3) {
            suggestionsList.innerHTML = '';
            suggestionsContainer.style.display = 'none';
            return;
        }

        fetch(`/interests/?query=${encodeURIComponent(query)}`)
            .then(response => response.json())
            .then(data => {
                suggestionsList.innerHTML = '';

                if (data.suggestions && data.suggestions.length > 0) {
                    suggestionsContainer.style.display = 'block';
                    data.suggestions.forEach(item => {
                        const li = document.createElement('li');
                        li.textContent = `${item.name} (${item.category})`;
                        suggestionsList.appendChild(li);
                    });
                } else {
                    suggestionsContainer.style.display = 'none';
                }
            })
            .catch(error => {
                console.error('Error fetching suggestions:', error);
            });
    }

    document.addEventListener("DOMContentLoaded", function () {
        const input = document.getElementById("destination");
        input.addEventListener("keyup", function () {
            getSuggestions(input.value);
        });
    });
</script>
{% endblock %}
