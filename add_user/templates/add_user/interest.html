{% extends 'add_user/home.html' %}
{% load static %}

{% block content %}
<div class="container">
    <h2>Find Your Recommended Destinations</h2>

    <!-- Search form for destinations -->
    <form method="POST" id="interest-form">
        {% csrf_token %}
        <label for="destination">Enter Destination</label>
        <input type="text" id="destination" name="destination" placeholder="e.g., Mountains, Lakes, etc." required onkeyup="getSuggestions(this.value)">
        <button type="submit" id="submit-btn" style="display: none;">Get Recommendations</button>
    </form>

    {% if recommendations %}
        <h3>Recommended Destinations:</h3>
        <ul>
            {% for category, places in recommendations.items %}
                <li>
                    <strong>{{ category|title }}:</strong>
                    <ul>
                        {% for place in places %}
                            <li>{{ place }}</li>
                        {% endfor %}
                    </ul>
                </li>
            {% endfor %}
        </ul>
    {% endif %}

    <!-- Container for dynamic search suggestions -->
    <div id="suggestions-container" style="margin-top: 20px;">
        <ul id="suggestions-list"></ul>
    </div>
</div>
{% endblock %}

{% block javascript %}
<script>
    function getSuggestions(query) {
        if (query.length < 3) {
            document.getElementById('suggestions-container').style.display = 'none';
            return;
        }

        // Fetch suggestions based on user input
        fetch(`/interests/?query=${query}`)
            .then(response => response.json())
            .then(data => {
                const suggestionsContainer = document.getElementById('suggestions-list');
                suggestionsContainer.innerHTML = ''; // Clear previous suggestions
                
                // Show the suggestions container if suggestions are found
                if (data.suggestions && data.suggestions.length > 0) {
                    document.getElementById('suggestions-container').style.display = 'block';
                    data.suggestions.forEach(item => {
                        const li = document.createElement('li');
                        li.textContent = `${item.name} (${item.category})`;
                        suggestionsContainer.appendChild(li);
                    });
                } else {
                    document.getElementById('suggestions-container').style.display = 'none';
                }
            });
    }

    // Form submission handling for fallback if needed
    document.getElementById('interest-form').addEventListener('submit', function(event) {
        event.preventDefault();  // Prevent page reload

        const query = document.getElementById('destination').value;
        fetch(`/interests/?query=${query}`)  // Fetch recommendations when form is submitted
            .then(response => response.json())
            .then(data => {
                const recommendationsContainer = document.getElementById('recommendations-container');
                recommendationsContainer.innerHTML = ''; // Clear previous recommendations

                if (data.suggestions && data.suggestions.length > 0) {
                    let html = '<h3>Recommended Destinations:</h3><ul>';
                    data.suggestions.forEach(item => {
                        html += `<li>${item.name} (${item.category})</li>`;
                    });
                    html += '</ul>';
                    recommendationsContainer.innerHTML = html;
                } else {
                    recommendationsContainer.innerHTML = '<p>No recommendations found.</p>';
                }
            });
    });
</script>
{% endblock %}
