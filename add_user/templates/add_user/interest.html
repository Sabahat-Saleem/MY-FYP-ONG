{% extends 'add_user/home.html' %}
{% load static %}

{% block content %}
<div class="container">
    <h2>Find Your Recommended Destinations</h2>

    <form id="interest-form" method="GET">
        <label for="destination">Enter Destination</label>
        <input type="text" id="destination" name="destination" placeholder="e.g., Mountains, Lakes, etc." required>
        <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
        <button type="submit" style="display: none;"></button>
    </form>
    
    <!-- Suggestions container -->
    <div id="suggestions-container" style="margin-top: 20px; display: none;">
        <ul id="suggestions-list"></ul>
    </div>

    <!-- Recommendations container -->
    <div id="recommendations-container" style="margin-top: 20px;">
        {% if recommendations %}
        <h3>Recommended Destinations:</h3>
        <ul>
            {% for category, places in recommendations.items %}
                <li>
                    <strong>{{ category|title }}:</strong>
                    <ul>
                        {% for place in places %}
                            <li>{{ place }}</li>
                        {% endfor %}
                    </ul>
                </li>
            {% endfor %}
        </ul>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.getElementById('interest-form').addEventListener('submit', function(event) {
        console.log("Form submitted"); // Check if this is triggered
        event.preventDefault();
    
        let query = document.getElementById('destination').value.trim();
        console.log("Query being sent:", query); // Log the query here
    
        if (!query) {
            console.log("Empty query, not sending request.");
            return;  // Don't make the request if query is empty
        }
    
        // Make the request only if query is not empty
        fetch(`/interest_page/?query=${query}`, {
            method: 'GET',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            },
        })
        .then(response => response.json())
        .then(data => {
            console.log(data);  // Log response for debugging
            let suggestionsContainer = document.getElementById('suggestions-container');
            suggestionsContainer.innerHTML = '';  // Clear previous suggestions
    
            if (data.suggestions.length) {
                data.suggestions.forEach(suggestion => {
                    let div = document.createElement('div');
                    div.textContent = suggestion;
                    suggestionsContainer.appendChild(div);
                });
            } else {
                suggestionsContainer.innerHTML = 'No suggestions found.';
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    document.getElementById('submit-button').addEventListener('click', function(event) {
        console.log("Button clicked"); // Check if this is triggered
        event.preventDefault();
    
        let query = document.getElementById('destination').value.trim();
        console.log("Query being sent:", query);
        if (!query) return;   
    });
</script>
{% endblock %}