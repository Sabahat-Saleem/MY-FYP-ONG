{% extends 'add_user/home.html' %}
{% load static %}

{% block content %}
<div class="container">
    <h2>Find Your Recommended Destinations</h2>

    <!-- Search form for destinations -->
    <form id="interest-form" method="GET">
        <label for="destination">Enter Destination</label>
        <input type="text" id="destination" name="destination" placeholder="e.g., Mountains, Lakes, etc." required>
        <button type="submit" style="display: none;"></button> <!-- optional: hides accidental submission -->
    </form>

    <!-- Suggestions container -->
    <div id="suggestions-container" style="margin-top: 20px; display: none;">
        <ul id="suggestions-list"></ul>
    </div>

    <!-- Recommendations container -->
    <div id="recommendations-container" style="margin-top: 20px;">
        {% if recommendations %}
        <h3>Recommended Destinations:</h3>
        <ul>
            {% for category, places in recommendations.items %}
                <li>
                    <strong>{{ category|title }}:</strong>
                    <ul>
                        {% for place in places %}
                            <li>{{ place }}</li>
                        {% endfor %}
                    </ul>
                </li>
            {% endfor %}
        </ul>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block javascript %}
<script>
    function getSuggestions(query) {
        console.log("Searching for:", query); // log query to check if it's correctly captured

        const suggestionsContainer = document.getElementById('suggestions-container');
        const suggestionsList = document.getElementById('suggestions-list');

        // Don't show suggestions if query is empty or too short
        if (!query || query.trim().length < 3) {
            suggestionsList.innerHTML = '';
            suggestionsContainer.style.display = 'none';
            return;
        }

        // Fetch suggestions from the backend (ensure this is a GET request)
        fetch(`/interests/?query=${encodeURIComponent(query)}`, {
            method: 'GET'  // Ensure this is a GET request
        })
        .then(response => response.json())
        .then(data => {
            console.log("Suggestions data:", data); // Check the response from the server

            suggestionsList.innerHTML = ''; // Clear previous suggestions

            if (data.suggestions && data.suggestions.length > 0) {
                suggestionsContainer.style.display = 'block'; // Show suggestions container

                // Create a string to append all items at once for performance
                const items = data.suggestions.map(item => {
                    return `<li>${item}</li>`;  // Only show the place name
                }).join('');

                suggestionsList.innerHTML = items; // Append all items at once
            } else {
                suggestionsContainer.style.display = 'none'; // Hide if no suggestions
                suggestionsList.innerHTML = '<li>No suggestions found.</li>'; // Show message if no suggestions
            }
        })
        .catch(error => {
            console.error('Error fetching suggestions:', error);
        });
    }
</script>
{% endblock %}
