{% extends 'add_user/home.html' %}
{% load static %}
{% block content %}
<div class="container" style="background-color: red;">
    <h2>Find Your Interests</h2>

    <!-- Search form for interests -->
    <form method="POST">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Search</button>
    </form>

    {% if message %}
        <p>{{ message }}</p>
    {% endif %}

   <!-- Container for Results -->
   <div id="results-container">
       {% include 'add_user/results.html' %}
   </div>

   <!-- Container for Recommendations -->
   <div id="recommendations-container">
       {% include 'add_user/recommendations.html' %}
   </div>

    <!-- Display recommendations if available -->
    {% if recommendations %}
        <h3>Recommended for You</h3>
        <ul>
            {% for item in recommendations %}
                <li>{{ item.topic }}</li>
            {% endfor %}
        </ul>
    {% endif %}
</div>

<!-- Input field for dynamic search suggestions -->
<input type="text" id="interest-search" placeholder="Search for interests..." onkeyup="getSuggestions(this.value)" />

<!-- Container for dynamic suggestions -->
<ul id="suggestions-list"></ul>
{% endblock %}

<!-- JS code -->
{% block javascript %}
<script>
document.addEventListener("DOMContentLoaded", function () {
    console.log("You idiot"); // Just for debugging

    const form = document.querySelector("form");

    form.addEventListener("submit", function (e) {
        e.preventDefault();  // Prevent full page reload

        const formData = new FormData(form);

        fetch("{% url 'get_interest_info' %}", {
            method: "POST",
            headers: {
                "X-CSRFToken": form.querySelector("[name=csrfmiddlewaretoken]").value,
                "X-Requested-With": "XMLHttpRequest"
            },
            body: formData
        })
        .then(response => response.json())  // Wait for JSON response
        .then(data => {
            // Debug: Check if the containers are found
            const resultsContainer = document.getElementById("results-container");
            const recommendationsContainer = document.getElementById("recommendations-container");

            console.log("Results container:", resultsContainer);
            console.log("Recommendations container:", recommendationsContainer);

            if (resultsContainer && recommendationsContainer) {
                resultsContainer.innerHTML = data.results_html;  // Update results
                recommendationsContainer.innerHTML = data.recommendations_html;  // Update recommendations
            } else {
                console.error("One or both containers not found!");  // Log error if containers don't exist
            }
        })
        .catch(error => console.error("Error:", error));  // Log any fetch errors
    });
});
</script>
{% endblock %}
